---
title: Modulo Core di ASP.NET
author: tdykstra
description: Introduce ASP.NET Core modulo (ANCM), un modulo IIS che consente al server web Kestrel utilizzare IIS o IIS Express come server proxy inverso.
keywords: Modulo di base di ASP.NET Core, IIS, IIS Express,ASP.NET, UseIISIntegration
ms.author: tdykstra
manager: wpickett
ms.date: 08/03/2017
ms.topic: article
ms.assetid: 4661af33-34c5-4d71-93a0-8c7632f43580
ms.technology: aspnet
ms.prod: asp.net-core
uid: fundamentals/servers/aspnet-core-module
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 5eef9405c0c3d219755d7cffa5d45c3df45ddb5c
ms.sourcegitcommit: 12e5194936b7e820efc5505a2d5d4f84e88eb5ef
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/11/2018
---
# <a name="introduction-to-aspnet-core-module"></a><span data-ttu-id="c3dbd-104">Introduzione al modulo ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="c3dbd-104">Introduction to ASP.NET Core Module</span></span>

<span data-ttu-id="c3dbd-105">Da [Tom Dykstra](https://github.com/tdykstra), [Rick Strahl](https://github.com/RickStrahl), e [Chris Ross](https://github.com/Tratcher)</span><span class="sxs-lookup"><span data-stu-id="c3dbd-105">By [Tom Dykstra](https://github.com/tdykstra), [Rick Strahl](https://github.com/RickStrahl), and [Chris Ross](https://github.com/Tratcher)</span></span> 

<span data-ttu-id="c3dbd-106">Modulo Core ASP.NET (ANCM) consente di eseguire le applicazioni protetti da IIS, ASP.NET Core utilizzando IIS è bene (sicurezza, gestibilità e altro ancora) e [Kestrel](kestrel.md) è bene (da velocemente) e il recupero di vantaggi di entrambe le tecnologie in una sola volta.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-106">ASP.NET Core Module (ANCM) lets you run ASP.NET Core applications behind IIS, using IIS for what it's good at (security, manageability, and lots more) and using [Kestrel](kestrel.md) for what it's good at (being really fast), and getting the benefits from both technologies at once.</span></span> <span data-ttu-id="c3dbd-107">**ANCM funziona solo con Kestrel; non è compatibile con WebListener (in ASP.NET Core 1. x) o HTTP.sys (in 2. x).**</span><span class="sxs-lookup"><span data-stu-id="c3dbd-107">**ANCM works only with Kestrel; it isn't compatible with WebListener (in ASP.NET Core 1.x) or HTTP.sys (in 2.x).**</span></span> 

<span data-ttu-id="c3dbd-108">Versioni supportate di Windows:</span><span class="sxs-lookup"><span data-stu-id="c3dbd-108">Supported Windows versions:</span></span>

* <span data-ttu-id="c3dbd-109">Windows 7 e Windows Server 2008 R2 e versioni successive</span><span class="sxs-lookup"><span data-stu-id="c3dbd-109">Windows 7 and Windows Server 2008 R2 and later</span></span>

<span data-ttu-id="c3dbd-110">[Visualizzare o scaricare il codice di esempio](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample) ([procedura per il download](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="c3dbd-110">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="what-aspnet-core-module-does"></a><span data-ttu-id="c3dbd-111">Funzionamento di ASP.NET Core modulo</span><span class="sxs-lookup"><span data-stu-id="c3dbd-111">What ASP.NET Core Module does</span></span>

<span data-ttu-id="c3dbd-112">ANCM è un modulo nativo di IIS che si associa alla pipeline di IIS e reindirizza il traffico nel back-end dell'applicazione ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-112">ANCM is a native IIS module that hooks into the IIS pipeline and redirects traffic to the backend ASP.NET Core application.</span></span> <span data-ttu-id="c3dbd-113">La maggior parte degli altri moduli, ad esempio l'autenticazione di windows, è comunque essere eseguito.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-113">Most other modules, such as windows authentication, still get a chance to run.</span></span> <span data-ttu-id="c3dbd-114">ANCM assume il controllo solo quando viene selezionato un gestore per la richiesta e mapping del gestore è definito nell'applicazione *Web. config* file.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-114">ANCM only takes control when a handler is selected for the request, and handler mapping is defined in the application *web.config* file.</span></span>

<span data-ttu-id="c3dbd-115">Poiché le applicazioni ASP.NET Core eseguite in un processo diversi dal processo di lavoro IIS, ANCM anche dei processi.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-115">Because ASP.NET Core applications run in a process separate from the IIS worker process, ANCM also does process management.</span></span> <span data-ttu-id="c3dbd-116">Quando la prima richiesta in riavviarlo quando si blocca, ANCM avvia il processo per l'applicazione ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-116">ANCM starts the process for the ASP.NET Core application when the first request comes in and restarts it when it crashes.</span></span> <span data-ttu-id="c3dbd-117">Si tratta essenzialmente lo stesso comportamento di applicazioni ASP.NET classiche che eseguono e in-process in IIS sono gestite da WAS (Windows Activation Service).</span><span class="sxs-lookup"><span data-stu-id="c3dbd-117">This is essentially the same behavior as classic ASP.NET applications that run in-process in IIS and are managed by WAS (Windows Activation Service).</span></span>

<span data-ttu-id="c3dbd-118">Di seguito è riportato un diagramma che illustra la relazione tra le applicazioni di IIS, ANCM e ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-118">Here's a diagram that illustrates the relationship between IIS, ANCM, and ASP.NET Core applications.</span></span>

![Modulo Core di ASP.NET](aspnet-core-module/_static/ancm.png)

<span data-ttu-id="c3dbd-120">Le richieste di entrare dal Web e raggiunge il driver Http.Sys in modalità kernel che li indirizza in IIS in cui la porta principale (80) o una porta SSL (443).</span><span class="sxs-lookup"><span data-stu-id="c3dbd-120">Requests come in from the Web and hit the kernel mode Http.Sys driver which routes them into IIS on the primary port (80) or SSL port (443).</span></span> <span data-ttu-id="c3dbd-121">ANCM inoltra le richieste all'applicazione ASP.NET di base sulla porta HTTP configurata per l'applicazione, che non è la porta 80/443.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-121">ANCM forwards the requests to the ASP.NET Core application on the HTTP port configured for the application, which is not port 80/443.</span></span>

<span data-ttu-id="c3dbd-122">Kestrel in ascolto del traffico proveniente da ANCM.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-122">Kestrel listens for traffic coming from ANCM.</span></span>  <span data-ttu-id="c3dbd-123">ANCM specifica la porta tramite la variabile di ambiente all'avvio e [UseIISIntegration](#call-useiisintegration) metodo consente di configurare il server per l'ascolto su `http://localhost:{port}`.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-123">ANCM specifies the port via environment variable at startup, and the [UseIISIntegration](#call-useiisintegration) method configures the server to listen on `http://localhost:{port}`.</span></span> <span data-ttu-id="c3dbd-124">Sono disponibili ulteriori controlli per rifiutare la richiesta non ANCM.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-124">There are additional checks to reject requests not from ANCM.</span></span> <span data-ttu-id="c3dbd-125">(ANCM non supporta l'inoltro HTTPS, pertanto le richieste vengono inoltrate tramite HTTP, anche se ricevuto da IIS tramite HTTPS.)</span><span class="sxs-lookup"><span data-stu-id="c3dbd-125">(ANCM does not support HTTPS forwarding, so requests are forwarded over HTTP even if received by IIS over HTTPS.)</span></span>

<span data-ttu-id="c3dbd-126">Kestrel preleva le richieste dal ANCM e li inserisce nella pipeline di middleware di ASP.NET Core, che quindi vengono gestiti e li invia come `HttpContext` istanze per la logica dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-126">Kestrel picks up requests from ANCM and pushes them into the ASP.NET Core middleware pipeline, which then handles them and passes them on as `HttpContext` instances to application logic.</span></span> <span data-ttu-id="c3dbd-127">Le risposte dell'applicazione vengono quindi passate a IIS, quali inserimenti li tornare indietro al client che ha avviato le richieste HTTP.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-127">The application's responses are then passed back to IIS, which pushes them back out to the HTTP client that initiated the requests.</span></span>

<span data-ttu-id="c3dbd-128">ANCM presenta alcune altre funzioni:</span><span class="sxs-lookup"><span data-stu-id="c3dbd-128">ANCM has a few other functions as well:</span></span>

* <span data-ttu-id="c3dbd-129">Imposta le variabili di ambiente.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-129">Sets environment variables.</span></span>
* <span data-ttu-id="c3dbd-130">Registri `stdout` all'archiviazione file di output.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-130">Logs `stdout` output to file storage.</span></span>
* <span data-ttu-id="c3dbd-131">Inoltra il token di autenticazione di Windows.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-131">Forwards Windows authentication tokens.</span></span>

## <a name="how-to-use-ancm-in-aspnet-core-apps"></a><span data-ttu-id="c3dbd-132">Come usare ANCM nelle applicazioni ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="c3dbd-132">How to use ANCM in ASP.NET Core apps</span></span>

<span data-ttu-id="c3dbd-133">In questa sezione viene fornita una panoramica del processo per la configurazione di un server IIS e l'applicazione ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-133">This section provides an overview of the process for setting up an IIS server and ASP.NET Core application.</span></span> <span data-ttu-id="c3dbd-134">Per istruzioni dettagliate, vedere [Host su Windows con IIS](xref:host-and-deploy/iis/index).</span><span class="sxs-lookup"><span data-stu-id="c3dbd-134">For detailed instructions, see [Host on Windows with IIS](xref:host-and-deploy/iis/index).</span></span>

### <a name="install-ancm"></a><span data-ttu-id="c3dbd-135">Installare ANCM</span><span class="sxs-lookup"><span data-stu-id="c3dbd-135">Install ANCM</span></span>


<span data-ttu-id="c3dbd-136">Il modulo di base di ASP.NET deve essere installato in IIS nei server e in IIS Express nel computer di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-136">The ASP.NET Core Module has to be installed in IIS on your servers and in IIS Express on your development machines.</span></span> <span data-ttu-id="c3dbd-137">Per i server, ANCM è incluso nel [.NET Core Windows Server che ospita bundle](https://aka.ms/dotnetcore-2-windowshosting).</span><span class="sxs-lookup"><span data-stu-id="c3dbd-137">For servers, ANCM is included in the [.NET Core Windows Server Hosting bundle](https://aka.ms/dotnetcore-2-windowshosting).</span></span> <span data-ttu-id="c3dbd-138">Per i computer di sviluppo, Visual Studio installa automaticamente ANCM in IIS Express in IIS se è già installato nel computer.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-138">For development machines, Visual Studio automatically installs ANCM in IIS Express, and in IIS if it is already installed on the machine.</span></span>

### <a name="install-the-iisintegration-nuget-package"></a><span data-ttu-id="c3dbd-139">Installare il pacchetto IISIntegration NuGet</span><span class="sxs-lookup"><span data-stu-id="c3dbd-139">Install the IISIntegration NuGet package</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="c3dbd-140">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="c3dbd-140">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="c3dbd-141">Il [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) pacchetto è incluso in metapackages di ASP.NET Core ([Microsoft.AspNetCore](https://www.nuget.org/packages/Microsoft.AspNetCore/) e [Microsoft.AspNetCore.All](xref:fundamentals/metapackage) ).</span><span class="sxs-lookup"><span data-stu-id="c3dbd-141">The [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) package is included in the ASP.NET Core metapackages ([Microsoft.AspNetCore](https://www.nuget.org/packages/Microsoft.AspNetCore/) and [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)).</span></span> <span data-ttu-id="c3dbd-142">Se non si utilizza uno del metapackages, installare `Microsoft.AspNetCore.Server.IISIntegration` separatamente.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-142">If you don't use one of the metapackages, install `Microsoft.AspNetCore.Server.IISIntegration` separately.</span></span> <span data-ttu-id="c3dbd-143">Il `IISIntegration` pacchetto è un pacchetto di interoperabilità che vengono lette le variabili di ambiente da ANCM per impostare l'app.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-143">The `IISIntegration` package is an interoperability pack that reads environment variables broadcast by ANCM to set up your app.</span></span> <span data-ttu-id="c3dbd-144">Le variabili di ambiente è fornire informazioni di configurazione, ad esempio la porta per l'ascolto.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-144">The environment variables provide configuration information, such as the port to listen on.</span></span> 

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="c3dbd-145">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="c3dbd-145">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="c3dbd-146">Nell'applicazione, installare [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span><span class="sxs-lookup"><span data-stu-id="c3dbd-146">In your application, install [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span></span> <span data-ttu-id="c3dbd-147">Il `IISIntegration` pacchetto è un pacchetto di interoperabilità che vengono lette le variabili di ambiente da ANCM per impostare l'app.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-147">The `IISIntegration` package  is an interoperability pack that reads environment variables broadcast by ANCM to set up your app.</span></span> <span data-ttu-id="c3dbd-148">Le variabili di ambiente è fornire informazioni di configurazione, ad esempio la porta per l'ascolto.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-148">The environment variables provide configuration information, such as the port to listen on.</span></span> 

---

### <a name="call-useiisintegration"></a><span data-ttu-id="c3dbd-149">Chiamare UseIISIntegration</span><span class="sxs-lookup"><span data-stu-id="c3dbd-149">Call UseIISIntegration</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="c3dbd-150">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="c3dbd-150">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="c3dbd-151">Il `UseIISIntegration` metodo di estensione su [ `WebHostBuilder` ](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder) viene chiamato automaticamente quando si esegue con IIS.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-151">The `UseIISIntegration` extension method on [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder) is called automatically when you run with IIS.</span></span>

<span data-ttu-id="c3dbd-152">Se si non utilizzando uno dei metapackages di ASP.NET Core e non sono stati installati il `Microsoft.AspNetCore.Server.IISIntegration` pacchetto, si ottiene un errore di runtime.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-152">If you aren't using one of the ASP.NET Core metapackages and haven't installed the  `Microsoft.AspNetCore.Server.IISIntegration` package, you get a runtime error.</span></span> <span data-ttu-id="c3dbd-153">Se si chiama `UseIISIntegration` in modo esplicito, ottenere un errore in fase di compilazione se non è installato il pacchetto.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-153">If you call `UseIISIntegration` explicitly, you get a compile time error if the package isn't installed.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="c3dbd-154">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="c3dbd-154">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="c3dbd-155">In un'applicazione `Main` metodo, chiamare il `UseIISIntegration` metodo di estensione su [ `WebHostBuilder` ](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder).</span><span class="sxs-lookup"><span data-stu-id="c3dbd-155">In your application's `Main` method, call the `UseIISIntegration` extension method on [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder).</span></span> 

[!code-csharp[](aspnet-core-module/sample/Program.cs?name=snippet_Main&highlight=12)]

---

<span data-ttu-id="c3dbd-156">Il `UseIISIntegration` metodo esegue la ricerca per le variabili di ambiente che imposta ANCM e no-ops se essi non vengono trovate.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-156">The `UseIISIntegration` method looks for environment variables that ANCM sets, and it no-ops if they aren't found.</span></span> <span data-ttu-id="c3dbd-157">Questo comportamento semplifica gli scenari quali lo sviluppo e test in macOS o Linux e la distribuzione in un server che esegue IIS.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-157">This behavior facilitates scenarios like developing and testing on macOS or Linux and deploying to a server that runs IIS.</span></span> <span data-ttu-id="c3dbd-158">Durante l'esecuzione in macOS o Linux, Kestrel funge da server web. Tuttavia, quando l'applicazione viene distribuita nell'ambiente di IIS, viene automaticamente ANCM e IIS.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-158">While running on macOS or Linux, Kestrel acts as the web server; but when the app is deployed to the IIS environment, it automatically uses ANCM and IIS.</span></span>

### <a name="ancm-port-binding-overrides-other-port-bindings"></a><span data-ttu-id="c3dbd-159">Binding porta ANCM esegue l'override di altri binding delle porte</span><span class="sxs-lookup"><span data-stu-id="c3dbd-159">ANCM port binding overrides other port bindings</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="c3dbd-160">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="c3dbd-160">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="c3dbd-161">ANCM genera una porta dinamica da assegnare al processo di back-end.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-161">ANCM generates a dynamic port to assign to the back-end process.</span></span> <span data-ttu-id="c3dbd-162">Il `UseIISIntegration` metodo preleva la porta dinamica e configura Kestrel per l'ascolto su `http://locahost:{dynamicPort}/`.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-162">The `UseIISIntegration` method picks up this dynamic port and configures Kestrel to listen on `http://locahost:{dynamicPort}/`.</span></span> <span data-ttu-id="c3dbd-163">Si esegue l'override di altre configurazioni di URL, quali chiamate a `UseUrls` o [API del Kestrel di ascolto](xref:fundamentals/servers/kestrel?tabs=aspnetcore2x#endpoint-configuration).</span><span class="sxs-lookup"><span data-stu-id="c3dbd-163">This overrides other URL configurations, such as calls to `UseUrls` or [Kestrel's Listen API](xref:fundamentals/servers/kestrel?tabs=aspnetcore2x#endpoint-configuration).</span></span> <span data-ttu-id="c3dbd-164">Pertanto, non è necessario chiamare `UseUrls` o del Kestrel `Listen` API quando si utilizza ANCM.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-164">Therefore, you don't need to call `UseUrls` or Kestrel's `Listen` API when you use ANCM.</span></span> <span data-ttu-id="c3dbd-165">Se si chiama `UseUrls` o `Listen`, Kestrel è in ascolto sulla porta specificati quando si esegue l'app senza IIS.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-165">If you do call `UseUrls` or `Listen`, Kestrel listens on the port you specify when you run the app without IIS.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="c3dbd-166">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="c3dbd-166">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="c3dbd-167">ANCM genera una porta dinamica da assegnare al processo di back-end.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-167">ANCM generates a dynamic port to assign to the back-end process.</span></span> <span data-ttu-id="c3dbd-168">Il `UseIISIntegration` metodo preleva la porta dinamica e configura Kestrel per l'ascolto su `http://locahost:{dynamicPort}/`.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-168">The `UseIISIntegration` method picks up this dynamic port and configures Kestrel to listen on `http://locahost:{dynamicPort}/`.</span></span> <span data-ttu-id="c3dbd-169">Si esegue l'override di altre configurazioni di URL, quali chiamate a `UseUrls`.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-169">This overrides other URL configurations, such as calls to `UseUrls`.</span></span> <span data-ttu-id="c3dbd-170">Pertanto, non è necessario chiamare `UseUrls` quando si utilizza ANCM.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-170">Therefore, you don't need to call `UseUrls` when you use ANCM.</span></span> <span data-ttu-id="c3dbd-171">Se si chiama `UseUrls`, Kestrel è in ascolto sulla porta specificati quando si esegue l'app senza IIS.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-171">If you do call `UseUrls`, Kestrel listens on the port you specify when you run the app without IIS.</span></span>

<span data-ttu-id="c3dbd-172">In ASP.NET Core 1.0, se si chiama `UseUrls`, chiamarlo **prima** si chiama `UseIISIntegration` in modo che la porta configurata ANCM non viene sovrascritto.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-172">In ASP.NET Core 1.0, if you call `UseUrls`, call it **before** you call `UseIISIntegration` so that the ANCM-configured port doesn't get overwritten.</span></span> <span data-ttu-id="c3dbd-173">Questo ordine di chiamata non è obbligatoria in ASP.NET 1.1 Core, perché esegue l'override dell'impostazione ANCM `UseUrls`.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-173">This calling order isn't required in ASP.NET Core 1.1, because the ANCM setting overrides `UseUrls`.</span></span>

---

### <a name="configure-ancm-options-in-webconfig"></a><span data-ttu-id="c3dbd-174">Configurare le opzioni di ANCM in Web. config</span><span class="sxs-lookup"><span data-stu-id="c3dbd-174">Configure ANCM options in Web.config</span></span>

<span data-ttu-id="c3dbd-175">Configurazione per il modulo di base di ASP.NET viene archiviata nel *Web. config* file che si trova nella cartella radice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-175">Configuration for the ASP.NET Core Module is stored in the *web.config* file that is located in the application's root folder.</span></span> <span data-ttu-id="c3dbd-176">Impostazioni di questo file scegliere il comando di avvio e gli argomenti che avvia l'app ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-176">Settings in this file point to the startup command and arguments that start your ASP.NET Core app.</span></span> <span data-ttu-id="c3dbd-177">Per esempio *Web. config* codice e informazioni aggiuntive sulle opzioni di configurazione, vedere [riferimento di configurazione di ASP.NET Core modulo](xref:host-and-deploy/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="c3dbd-177">For sample *web.config* code and guidance on configuration options, see [ASP.NET Core Module Configuration Reference](xref:host-and-deploy/aspnet-core-module).</span></span>

### <a name="run-with-iis-express-in-development"></a><span data-ttu-id="c3dbd-178">Esecuzione di IIS Express in fase di sviluppo</span><span class="sxs-lookup"><span data-stu-id="c3dbd-178">Run with IIS Express in development</span></span>

<span data-ttu-id="c3dbd-179">IIS Express può essere avviata da Visual Studio usando il profilo predefinito definito tramite i modelli ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-179">IIS Express can be launched by Visual Studio using the default profile defined by the ASP.NET Core templates.</span></span>

## <a name="proxy-configuration-uses-http-protocol-and-a-pairing-token"></a><span data-ttu-id="c3dbd-180">Configurazione del proxy utilizza il protocollo HTTP e un token di associazione</span><span class="sxs-lookup"><span data-stu-id="c3dbd-180">Proxy configuration uses HTTP protocol and a pairing token</span></span>

<span data-ttu-id="c3dbd-181">Il proxy creato tra il ANCM e Kestrel utilizza il protocollo HTTP.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-181">The proxy created between the ANCM and Kestrel uses the HTTP protocol.</span></span> <span data-ttu-id="c3dbd-182">Utilizzo di HTTP è un'ottimizzazione delle prestazioni in cui il traffico tra il ANCM e Kestrel effettuata in un indirizzo di loopback dall'interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-182">Using HTTP is a performance optimization where the traffic between the ANCM and Kestrel takes place on a loopback address off of the network interface.</span></span> <span data-ttu-id="c3dbd-183">Non c'è alcun rischio di intercettazione il traffico tra il ANCM e Kestrel da una posizione dal server.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-183">There's no risk of eavesdropping the traffic between the ANCM and Kestrel from a location off of the server.</span></span>

<span data-ttu-id="c3dbd-184">Un token di associazione viene utilizzato per garantire che le richieste ricevute da Kestrel sono state elaborate da IIS e che non provengono da un'altra origine.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-184">A pairing token is used to guarantee that the requests received by Kestrel were proxied by IIS and didn't come from some other source.</span></span> <span data-ttu-id="c3dbd-185">Il token di associazione viene creato e impostato in una variabile di ambiente (`ASPNETCORE_TOKEN`) per il ANCM.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-185">The pairing token is created and set into an environment variable (`ASPNETCORE_TOKEN`) by the ANCM.</span></span> <span data-ttu-id="c3dbd-186">Il token di associazione viene impostato anche in un'intestazione (`MSAspNetCoreToken`) in tutte le richieste elaborate.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-186">The pairing token is also set into a header (`MSAspNetCoreToken`) on every proxied request.</span></span> <span data-ttu-id="c3dbd-187">Controlla il Middleware di IIS richiesta che riceve per confermare che il valore di intestazione dei token di associazione corrisponda al valore di variabile di ambiente.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-187">IIS Middleware checks each request it receives to confirm that the pairing token header value matches the environment variable value.</span></span> <span data-ttu-id="c3dbd-188">Se i valori del token non corrispondono, la richiesta viene registrata e rifiutata.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-188">If the token values are mismatched, the request is logged and rejected.</span></span> <span data-ttu-id="c3dbd-189">La variabile di ambiente token di associazione e il traffico tra il ANCM e Kestrel non sono accessibili da una posizione dal server.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-189">The pairing token environment variable and the traffic between the ANCM and Kestrel aren't accessible from a location off of the server.</span></span> <span data-ttu-id="c3dbd-190">Senza conoscere il valore del token di associazione, un utente malintenzionato non è possibile inviare le richieste che ignora il controllo nel Middleware di IIS.</span><span class="sxs-lookup"><span data-stu-id="c3dbd-190">Without knowing the pairing token value, an attacker can't submit requests that bypass the check in the IIS Middleware.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c3dbd-191">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="c3dbd-191">Next steps</span></span>

<span data-ttu-id="c3dbd-192">Per altre informazioni, vedere le seguenti risorse:</span><span class="sxs-lookup"><span data-stu-id="c3dbd-192">For more information, see the following resources:</span></span>

* [<span data-ttu-id="c3dbd-193">Applicazione di esempio per questo articolo</span><span class="sxs-lookup"><span data-stu-id="c3dbd-193">Sample app for this article</span></span>](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample)
* [<span data-ttu-id="c3dbd-194">Codice sorgente ASP.NET modulo Core</span><span class="sxs-lookup"><span data-stu-id="c3dbd-194">ASP.NET Core Module source code</span></span>](https://github.com/aspnet/AspNetCoreModule)
* [<span data-ttu-id="c3dbd-195">Guida di riferimento per la configurazione del modulo ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="c3dbd-195">ASP.NET Core Module Configuration Reference</span></span>](xref:host-and-deploy/aspnet-core-module)
* [<span data-ttu-id="c3dbd-196">Host in Windows con IIS</span><span class="sxs-lookup"><span data-stu-id="c3dbd-196">Host on Windows with IIS</span></span>](xref:host-and-deploy/iis/index)
